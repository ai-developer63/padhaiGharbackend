<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
	th:replace="~{base::Layout(~{::section})}">
<head>
<meta charset="UTF-8">
<title>Add Course</title>

<style>
.image-preview {
	width: 120px;
	height: 120px;
	border: 2px dashed #ccc;
	border-radius: 10px;
	object-fit: cover;
	display: block;
	margin-top: 10px;
}
</style>

</head>
<body>

	<section class="container mt-4 py-4">

		<!-- Add / Edit Course Card -->
		<div class="card shadow-lg border-0 p-4 mb-4">
			<h4 class="mb-4">
				<i class="fa-solid fa-book text-primary"></i> [[${course.id == null
				? 'Add New Course' : 'Edit Course'}]]
			</h4>

			<form th:action="@{/admin/course/save}" th:object="${course}"
				method="post" enctype="multipart/form-data">

				<input type="hidden" th:field="*{id}">

				<div class="row g-4">

					<!-- Course Name -->
					<div class="col-md-6">
						<label class="form-label fw-bold">Course Name</label> <input
							type="text" class="form-control" th:field="*{name}" required>
					</div>

					<!-- Category -->
					<div class="col-md-6">
						<label class="form-label fw-bold">Category</label> <select
							class="form-select" th:field="*{categoryId}" required>
							<option value="">-- Select Category --</option>
							<option th:each="cat : ${categoryList}" th:value="${cat.id}"
								th:text="${cat.name}"></option>
						</select>
					</div>

					<!-- Teacher -->
					<div class="col-md-6">
						<label class="form-label fw-bold">Teacher</label> <select
							class="form-select" th:field="*{teacherId}" required>
							<option value="">-- Select Teacher --</option>
							<option th:each="t : ${teacherList}" th:value="${t.id}"
								th:text="${t.name}"></option>
						</select>
					</div>

					<!-- Price -->
					<div class="col-md-3">
						<label class="form-label fw-bold">Price</label> <input
							type="number" class="form-control" th:field="*{price}" required>
					</div>

					<!-- Discount -->
					<div class="col-md-3">
						<label class="form-label fw-bold">Max Discount (%)</label> <input
							type="number" class="form-control" th:field="*{discount}" min="0"
							max="100" required>
					</div>

					<!-- Description -->
					<div class="col-12">
						<label class="form-label fw-bold">Description</label>
						<textarea class="form-control" th:field="*{description}" rows="4"></textarea>
					</div>

					<!-- Tags -->
					<div class="col-md-6">
						<label class="form-label fw-bold">Search Tags</label> <input
							type="text" class="form-control" th:field="*{searchTags}">
					</div>

					<!-- Logo Upload -->
					<div class="col-md-6">
						<label class="form-label fw-bold">Course Logo</label> <input
							type="file" class="form-control" name="logoFile" accept="image/*"
							onchange="previewLogo(event)"> <img id="logoPreview"
							src="#" th:if="${course.logo != null}"
							th:src="@{'/course/logo/' + ${course.logo}}"
							class="image-preview" />
					</div>

					<!-- Active -->
					<div class="col-md-12 form-check mt-3">
						<input type="checkbox" class="form-check-input"
							th:field="*{isActive}"> <label
							class="form-check-label fw-bold">Active</label>
					</div>

					<!-- Save -->
					<div class="col-md-12 mt-3">
						<button type="submit" class="btn btn-primary w-100 py-2">
							<i class="fa-solid fa-check"></i> Save Course
						</button>
					</div>

				</div>
			</form>
		</div>


		<!-- List of Courses -->
		<div class="card shadow border-0 p-4">
			<h4 class="mb-3">
				<i class="fa-solid fa-list text-primary"></i> All Courses
			</h4>

			<div th:if="${msg}" class="alert alert-success">[[${msg}]]</div>

			<table class="table table-hover align-middle">
				<thead class="table-light">
					<tr>
						<th>ID</th>
						<th>Logo</th>
						<th>Name</th>
						<th>Category</th>
						<th>Teacher</th>
						<th>Price</th>
						<th>Discount</th>
						<th>Active</th>
						<th>Action</th>
					</tr>
				</thead>

				<tbody>
					<tr th:each="c : ${courses}">
						<td th:text="${c.id}"></td>

						<!-- Logo -->
						<td><img th:src="@{'/course/logo/' + ${c.logo}}"
							style="width: 50px; height: 50px; border-radius: 8px; object-fit: cover;">
						</td>

						<td th:text="${c.name}"></td>
						<td th:text="${c.categoryName}"></td>
						<td th:text="${c.teacherName}"></td>
						<td>रु [[${c.price}]]</td>
						<td>[[${c.discount}]]%</td>

						<td><span class="badge bg-success" th:if="${c.isActive}">Active</span>
							<span class="badge bg-danger" th:if="${!c.isActive}">Disabled</span>
						</td>

						<td><a th:href="@{/admin/course/edit(id=${c.id})}"
							class="btn btn-sm btn-primary"> Edit </a>

							<button class="btn btn-sm btn-danger"
								onclick="confirmDelete('[[${c.id}]]')">Delete</button></td>
					</tr>
				</tbody>
			</table>

		</div>

	</section>

	<script>
function previewLogo(event) {
    const reader = new FileReader();
    reader.onload = function(){
        const output = document.getElementById('logoPreview');
        output.src = reader.result;
        output.style.display = "block";
    }
    reader.readAsDataURL(event.target.files[0]);
}

function confirmDelete(id) {
    if (confirm("Are you sure you want to delete this course?")) {
        window.location = "/admin/course/delete?id=" + id;
    }
}
</script>

</body>
</html>
